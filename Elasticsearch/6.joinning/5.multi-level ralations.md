# Multi-Level Parent-Child Relationship in Elasticsearch

This documentation provides a step-by-step guide to setting up a **multi-level parent-child relationship** in Elasticsearch.

---

> **`flow`**
> ![alt text](image-1.png)

---

> **`how to stored`**
> ![alt text](image.png)

---

> **`how to write nested query`**
> ![alt text](image-2.png)

---

## **ğŸ“Œ Step 1: Create Index with Parent-Child Mapping**

```json
PUT company_index
{
  "mappings": {
    "properties": {
      "relation_field": {
        "type": "join",
        "relations": {
          "company": ["department", "supplier"],
          "department": "employee"
        }
      },
      "name": { "type": "text" }
    }
  }
}
```

### **ğŸ“ Explanation**

- **Company** â†’ Can have **Departments & Suppliers** as children.
- **Department** â†’ Can have **Employees** as children.
- **Supplier** â†’ No further children.

---

## **ğŸ“Œ Step 2: Insert Documents**

### **1ï¸âƒ£ Add Company (Parent Document)**

```json
POST company_index/_doc/1
{
  "name": "TechCorp",
  "relation_field": "company"
}
```

### **2ï¸âƒ£ Add Department (Child of Company)**

```json
POST company_index/_doc/2?routing=1
{
  "name": "HR Department",
  "relation_field": {
    "name": "department",
    "parent": 1
  }
}
```

### **3ï¸âƒ£ Add Supplier (Child of Company)**

```json
POST company_index/_doc/3?routing=1
{
  "name": "ABC Supplies",
  "relation_field": {
    "name": "supplier",
    "parent": 1
  }
}
```

### **4ï¸âƒ£ Add Employee (Child of Department)**

```json
POST company_index/_doc/4?routing=2
{
  "name": "Alice Johnson",
  "relation_field": {
    "name": "employee",
    "parent": 2
  }
}
```

---

## **ğŸ“Œ Step 3: Search Queries**

### **ğŸ” Get All Documents**

```json
GET company_index/_search
{
  "query": {
    "match_all": {}
  }
}
```

### **ğŸ” Get All Employees in a Specific Department**

```json
GET company_index/_search
{
  "query": {
    "has_parent": {
      "parent_type": "department",
      "query": {
        "match": {
          "name": "HR Department"
        }
      }
    }
  }
}
```

### **ğŸ” Get All Departments & Suppliers Under a Company**

```json
GET company_index/_search
{
  "query": {
    "has_parent": {
      "parent_type": "company",
      "query": {
        "match": {
          "name": "TechCorp"
        }
      }
    }
  }
}
```

---

## **ğŸš€ Summary**

âœ… **Multi-level parent-child relations set up correctly:**

- **Company** â†’ (Parent of) â†’ **Departments, Suppliers**
- **Department** â†’ (Parent of) â†’ **Employees**
- **Supplier** â†’ (No further children)

ğŸš€ **Now you can efficiently query hierarchical data using Elasticsearch!**
